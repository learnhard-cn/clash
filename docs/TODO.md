# TODO列表

记录一下打算做的一些功能，避免忘记了。

- [x] 增加软路由上线、下线自动监控功能。
- [x] 优化一些无意义的功能(`节点组切换模式`删掉、删除`启用黑名单模式`和`透明代理模式开关`、`更新版本`改为手动更新、clash面板更改为`http://<lan-ip>:9090/ui/yacd)
- [x] **增加**黑名单(匹配名单走代理,默认直连)、白名单(匹配名单直连,默认走代理)模式切换功能。
- [x] 优化 **添加节点**功能，支持URL订阅源批量添加，包括`base64`解析功能: 更新`uridecoder`程序实现。
- [x] 增加启动配置文件`config.yaml`校验功能: 内部脚本支持必要的config.yaml配置检验，如必要端口设置。
- [x] 增加上传自定义的config.yaml文件功能: 用户可以使用自己的订阅源proxy-providers,以及自己的代理组.
- [x] 增加备份与恢复配置功能: 方便使用者折腾,如果折腾失败了可以快速恢复到备份前状态.
- [x] 增加自定义**黑、白名单规则**界面配置功能: 想要单独设置某个网站使用代理或者直连(比如游戏网站、视频网站等)，这个功能就满足要求了.
- [x] 增加了**黑名单模式/白名单模式**选择: 黑名单模式时默认直连，白名单模式时默认走代理，匹配规则都来自于github分享。
- [x] 可视化编辑config.yaml文件及其包含的providers文件: v2.2.4版本支持。
- ~~[ ] 增加ADS广告过滤规则。~~
- [x] 支持vClash新版本升级提醒功能，页面加载时检测一次版本信息，如有新版本，提示在线升级功能。
- [x] 增加IPv6支持：添加了开关选项。
- ~~[ ] 支持挂载虚拟内存功能:无内存速度测试验证(适合不常使用虚拟内存情况,如果内存经常吃紧推荐买个MLC固态优盘)~~
- [x] 优化DDNS功能，启用CF代理功能(隐藏真实地址)。
- [x] 优化DDNS功能，支持IPv6地址功能。
- [x] 取消黑白名单模式：这个模式有点儿僵化，将以多配置文件列表取代这个功能，这样你可以随时切换多种用途的yaml格式启动配置文件达到不同使用需求(内置两个配置文件模板，如需要自己可以添加）。
- [x] 备份/恢复功能完善： 随着更宽泛的配置方式，目录结构将会调整，备份/恢复功能也将进行合理的规划一下，哪些需要备份与恢复（还是整体打包更简单呢）。
- [x] U盘分区自动挂载脚本，通常/koolshare/clash 目录所在分区类型为jffs类型，无法保存节点选择信息（cache.db)，解决方法：U盘分一个ext3类型分区，挂载到 /jffs 或 /koolshare 目录下(挂载前要拷贝所有原分区的文件)，这样就解决保存节点问题了。
- [x] 支持IPv6代理路由规则配置
- [ ] 支持Clash内核切换： Clash Premium/Clash.Meta **内核切换按钮**功能。

---


## 内核切换功能

原始版本Clash不再更新，虽然可以继续使用，但不会有任何新功能更新升级了。

然而，此时应运而生了Clash的替代产品，但是由于Clash Premium并没有开源，所以其他人实现的功能与官方版本还是有些差异的（兼容）。

目前，Clash.Meta项目成为了Clash替代的主力，功能支持非常丰富，尤其是订阅源支持的格式丰富，支持URI链接列表格式，还有支持Vless协议代理。

所以，支持 Clash.Meta内核很有必要的。

可是呢，Clash.Meta 内核在路由器配置中与 Clash.Premium 还是有区别的，因此需要针对 `Clash.Meta`实现特定的配置文件。

vClash插件也经过尝试，调整了运行稳定的配置文件**clash_meta.yaml** ， 当使用 `Clash.Meta`内核（如：**mihomo-linux-arm64-v1.18.5**）时，请切换使用**clash_meta.yaml**配置才可以正常使用。

当然，如果你了解如何配置，也可以上传自己的配置文件。


## IPv6使用问题

透明代理当涉及到IPv6规则时就很头疼，规则配置存在几个难题：


1. 开启TPROXY模式(包括 TPROXY+NAT模式)时，内网IPv6请求出去的流量显示出的公网IPv6地址其实是路由器的IPv6地址，


```mermaid
graph LR
    A[外网IPv6主机A] -->|数据包| B[路由器R]
    B -->|PREROUTING链| C[处理数据包前]
    C -->|FORWARD链| D[数据包转发到内网主机B]
    D -->|POSTROUTING链| E[数据包离开路由器R]
    E -->|到达内网主机B| F[内网主机B]

```
